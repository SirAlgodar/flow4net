{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/lib/diagnostics.ts"],"sourcesContent":["export interface DiagnosticResult {\n  device: {\n    userAgent: string;\n    os: string;\n    browser: string;\n    deviceMemory?: number;\n    hardwareConcurrency?: number;\n    gpu?: string;\n  };\n  network: {\n    ip: string;\n    connectionType?: string;\n    downlink?: number; \n    rtt?: number;\n    saveData?: boolean;\n    effectiveType?: string;\n    signalStrength?: number; // Simulated/Approximated\n    frequency?: number; // Simulated\n  };\n  quality?: {\n    score: number;\n    rating: 'Excelente' | 'Bom' | 'Regular' | 'Ruim' | 'Crítico';\n    issues: string[];\n    recommendations: string[];\n  };\n  speed: {\n    download: number; \n    upload: number; \n    ping: number; \n    jitter: number; \n  };\n  streaming: {\n    sd: boolean;\n    hd: boolean;\n    fullHd: boolean;\n    uhd: boolean;\n  };\n  externalStatus?: string;\n}\n\nexport class DiagnosticsEngine {\n  private updateCallback: (status: string, progress: number) => void;\n\n  constructor(onUpdate: (status: string, progress: number) => void) {\n    this.updateCallback = onUpdate;\n  }\n\n  async run(): Promise<DiagnosticResult> {\n    this.updateCallback('Coletando informações do dispositivo...', 0);\n    const device = this.getDeviceInfo();\n    \n    this.updateCallback('Detectando IP...', 10);\n    const ip = await this.getPublicIp();\n    \n    this.updateCallback('Testando Latência...', 20);\n    const { ping, jitter } = await this.measureLatency();\n    \n    this.updateCallback('Testando Download...', 40);\n    const download = await this.measureDownloadSpeed();\n    \n    this.updateCallback('Testando Upload...', 70);\n    const upload = await this.measureUploadSpeed();\n    \n    this.updateCallback('Verificando serviços externos...', 85);\n    const externalStatus = await this.checkExternalServices();\n\n    this.updateCallback('Analisando qualidade da conexão...', 88);\n    const networkInfo = (navigator as any).connection || {};\n    \n    // Log network info for debugging\n    console.log('Network Information API:', networkInfo);\n    \n    const quality = this.analyzeQuality(download, upload, ping, jitter, networkInfo);\n\n    this.updateCallback('Finalizando...', 90);\n\n    const streaming = {\n      sd: download > 1.5,\n      hd: download > 5,\n      fullHd: download > 8, \n      uhd: download > 25,\n    };\n    \n    // Ensure values are not undefined/null if possible, or leave as undefined for UI to handle\n    const connectionType = networkInfo.type || 'unknown';\n    const effectiveType = networkInfo.effectiveType || 'unknown';\n    const downlink = networkInfo.downlink;\n    const rtt = networkInfo.rtt;\n    \n    console.log('Captured Network Details:', { connectionType, effectiveType, downlink, rtt });\n\n    return {\n      device,\n      network: {\n        ip,\n        connectionType,\n        effectiveType: networkInfo.effectiveType,\n        downlink: networkInfo.downlink,\n        rtt: networkInfo.rtt,\n        saveData: networkInfo.saveData,\n        // Simulating WiFi details as standard Web API doesn't expose SSID/Signal Strength due to privacy\n        // In a real app, this might need a native wrapper or specific browser flags\n        signalStrength: this.estimateSignalStrength(networkInfo.rtt, networkInfo.downlink),\n        frequency: networkInfo.effectiveType === '4g' ? undefined : 2.4 // Assumption/Simulation\n      },\n      speed: {\n        download,\n        upload,\n        ping,\n        jitter,\n      },\n      streaming,\n      externalStatus,\n      quality\n    };\n  }\n\n  private estimateSignalStrength(rtt: number = 0, downlink: number = 0): number {\n      // Crude estimation: lower RTT + higher downlink = better signal\n      let score = 100;\n      if (rtt > 100) score -= 20;\n      if (rtt > 200) score -= 20;\n      if (downlink < 5) score -= 20;\n      if (downlink < 1) score -= 30;\n      return Math.max(0, score);\n  }\n\n  private analyzeQuality(download: number, upload: number, ping: number, jitter: number, netInfo: any) {\n      const issues: string[] = [];\n      const recommendations: string[] = [];\n      let score = 100;\n\n      // Speed Analysis\n      if (download < 5) {\n          score -= 30;\n          issues.push('Velocidade de download muito baixa');\n          recommendations.push('Feche outros aplicativos que consomem banda');\n      } else if (download < 15) {\n          score -= 10;\n          issues.push('Velocidade de download moderada');\n      }\n\n      // Latency Analysis\n      if (ping > 100) {\n          score -= 20;\n          issues.push('Latência (Ping) alta');\n          recommendations.push('Seproxime do roteador WiFi ou use cabo de rede');\n      }\n      \n      if (jitter > 30) {\n          score -= 15;\n          issues.push('Conexão instável (Jitter alto)');\n          recommendations.push('Verifique se há interferência na rede');\n      }\n\n      // Connection Type Analysis\n      if (netInfo.effectiveType === '2g' || netInfo.effectiveType === 'slow-2g') {\n          score -= 40;\n          issues.push('Conexão móvel muito lenta detectada');\n          recommendations.push('Tente conectar a uma rede WiFi');\n      }\n\n      let rating: 'Excelente' | 'Bom' | 'Regular' | 'Ruim' | 'Crítico' = 'Excelente';\n      if (score < 30) rating = 'Crítico';\n      else if (score < 50) rating = 'Ruim';\n      else if (score < 70) rating = 'Regular';\n      else if (score < 90) rating = 'Bom';\n\n      return { score, rating, issues, recommendations };\n  }\n\n  private async checkExternalServices() {\n    const services = [\n        { name: 'Google', url: 'https://www.google.com' },\n        { name: 'Netflix', url: 'https://www.netflix.com' },\n        { name: 'Facebook', url: 'https://www.facebook.com' }\n    ];\n    \n    const results = await Promise.all(services.map(async (s) => {\n        try {\n            // Use our server-side proxy to avoid CORS issues\n            const res = await fetch(`/api/diagnostics/external-check?url=${encodeURIComponent(s.url)}`);\n            if (!res.ok) throw new Error('Check failed');\n            const data = await res.json();\n            return { name: s.name, status: data.status, latency: data.latency };\n        } catch {\n            return { name: s.name, status: 'down', latency: 0 };\n        }\n    }));\n    return JSON.stringify(results);\n  }\n\n  private getDeviceInfo() {\n    const ua = navigator.userAgent;\n    let browser = \"Unknown\";\n    if(ua.indexOf(\"Chrome\") > -1) browser = \"Chrome\";\n    else if(ua.indexOf(\"Safari\") > -1) browser = \"Safari\";\n    else if(ua.indexOf(\"Firefox\") > -1) browser = \"Firefox\";\n\n    let os = \"Unknown\";\n    if(ua.indexOf(\"Win\") > -1) os = \"Windows\";\n    else if(ua.indexOf(\"Mac\") > -1) os = \"MacOS\";\n    else if(ua.indexOf(\"Linux\") > -1) os = \"Linux\";\n    else if(ua.indexOf(\"Android\") > -1) os = \"Android\";\n    else if(ua.indexOf(\"like Mac\") > -1) os = \"iOS\";\n\n    let gpu = \"Unknown\";\n    try {\n        const canvas = document.createElement('canvas');\n        const gl = canvas.getContext('webgl');\n        if (gl) {\n            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');\n            if (debugInfo) {\n                gpu = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n            }\n        }\n    } catch(e) {}\n\n    return {\n      userAgent: ua,\n      os,\n      browser,\n      deviceMemory: (navigator as any).deviceMemory,\n      hardwareConcurrency: navigator.hardwareConcurrency,\n      gpu\n    };\n  }\n\n  private async getPublicIp(): Promise<string> {\n    try {\n      const res = await fetch('/api/ip');\n      const data = await res.json();\n      return data.ip;\n    } catch {\n      return 'Unknown';\n    }\n  }\n\n  private async measureLatency() {\n    const pings: number[] = [];\n    for(let i=0; i<10; i++) {\n      const start = performance.now();\n      await fetch('/api/ip', { cache: 'no-store' }); \n      const end = performance.now();\n      pings.push(end - start);\n    }\n    const min = Math.min(...pings);\n    \n    const jitter = pings.reduce((acc, curr, i) => {\n        if (i === 0) return 0;\n        return acc + Math.abs(curr - pings[i-1]);\n    }, 0) / (pings.length - 1);\n    \n    return { ping: min, jitter };\n  }\n\n  private async measureDownloadSpeed(): Promise<number> {\n    try {\n      const startTime = performance.now();\n      const response = await fetch('/api/speedtest/download');\n      \n      if (!response.body) return 0;\n      \n      const reader = response.body.getReader();\n      let receivedLength = 0;\n\n      while(true) {\n        const {done, value} = await reader.read();\n        if (done) break;\n        receivedLength += value.length;\n      }\n      \n      const endTime = performance.now();\n      const duration = (endTime - startTime) / 1000; \n      if (duration <= 0) return 0;\n      \n      const bitsLoaded = receivedLength * 8;\n      const bps = bitsLoaded / duration;\n      return bps / (1024 * 1024); \n    } catch (e) {\n      console.error('Download test error:', e);\n      return 0;\n    }\n  }\n\n  private async measureUploadSpeed(): Promise<number> {\n    try {\n      const size = 5 * 1024 * 1024;\n      const buffer = new Uint8Array(size);\n      const startTime = performance.now();\n      \n      const res = await fetch('/api/speedtest/upload', {\n          method: 'POST',\n          body: buffer\n      });\n      \n      if (!res.ok) throw new Error('Upload failed');\n\n      const endTime = performance.now();\n      const duration = (endTime - startTime) / 1000;\n      if (duration <= 0) return 0;\n\n      const bits = size * 8;\n      return (bits / duration) / (1024 * 1024);\n    } catch (e) {\n      console.error('Upload test error:', e);\n      return 0;\n    }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/components/TestRunner.tsx"],"sourcesContent":["'use client';\nimport { useState, useEffect } from 'react';\nimport { DiagnosticsEngine, DiagnosticResult } from '@/lib/diagnostics';\nimport { Loader2, CheckCircle, Wifi, Gauge, Smartphone, Globe, Play, AlertTriangle, XCircle, Monitor, Gamepad2, Video, Radio, Activity } from 'lucide-react';\nimport { clsx, type ClassValue } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nfunction cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\nexport function TestRunner({ code }: { code: string }) {\n  const [loading, setLoading] = useState(true);\n  const [linkData, setLinkData] = useState<any>(null);\n  const [error, setError] = useState('');\n  \n  // Test State\n  const [hasStarted, setHasStarted] = useState(false);\n  const [finished, setFinished] = useState(false);\n  const [currentStep, setCurrentStep] = useState(0); // 0: Idle, 1: Device, 2: Network, 3: Speed, 4: Results\n  \n  // Data State\n  const [statusMsg, setStatusMsg] = useState('');\n  const [progress, setProgress] = useState(0);\n  const [result, setResult] = useState<DiagnosticResult | null>(null);\n  const [cpfCnpj, setCpfCnpj] = useState('');\n\n  const [retryCount, setRetryCount] = useState(0);\n  const [offlineMode, setOfflineMode] = useState(false);\n\n  useEffect(() => {\n    // Check for cached offline results and try to sync\n    const syncOfflineResults = async () => {\n        const cached = localStorage.getItem('offline_results');\n        if (cached) {\n            try {\n                const results = JSON.parse(cached);\n                if (Array.isArray(results)) {\n                    for (const r of results) {\n                        await fetch('/api/results', {\n                            method: 'POST',\n                            body: JSON.stringify(r)\n                        });\n                    }\n                    localStorage.removeItem('offline_results');\n                    console.log('Synced offline results');\n                }\n            } catch (e) {\n                console.error('Failed to sync offline results', e);\n            }\n        }\n    };\n    \n    if (navigator.onLine) {\n        syncOfflineResults();\n    }\n    \n    window.addEventListener('online', () => {\n        setOfflineMode(false);\n        syncOfflineResults();\n    });\n    window.addEventListener('offline', () => setOfflineMode(true));\n    \n    return () => {\n        window.removeEventListener('online', () => {});\n        window.removeEventListener('offline', () => {});\n    };\n  }, []);\n\n  useEffect(() => {\n    fetch(`/api/links/${code}`)\n      .then(res => {\n        if (!res.ok) throw new Error('Link inválido ou expirado');\n        return res.json();\n      })\n      .then(data => {\n        setLinkData(data);\n        if (data.cpfCnpj) setCpfCnpj(data.cpfCnpj);\n        setLoading(false);\n      })\n      .catch(err => {\n        setError(err.message);\n        setLoading(false);\n      });\n  }, [code]);\n\n  const runTest = async () => {\n    if (linkData.type !== 'UNIDENTIFIED' && !cpfCnpj) {\n        alert('Por favor informe o CPF/CNPJ para continuar');\n        return;\n    }\n    \n    setHasStarted(true);\n    setFinished(false);\n    setCurrentStep(1); // Device Info\n\n    const engine = new DiagnosticsEngine((s, p) => {\n        setStatusMsg(s);\n        setProgress(p);\n        \n        // Simple logic to map progress to steps for visual feedback\n        if (p < 20) setCurrentStep(1); // Device\n        else if (p < 40) setCurrentStep(2); // Network\n        else if (p < 85) setCurrentStep(3); // Speed\n        else setCurrentStep(4); // Quality/External\n    });\n\n    try {\n        const res = await engine.run();\n        setResult(res);\n        setFinished(true);\n        setCurrentStep(5); // Done\n        \n        const payload = {\n            linkId: linkData.id,\n            cpfCnpj,\n            device: res.device,\n            network: res.network,\n            speed: res.speed,\n            streaming: res.streaming,\n            externalStatus: res.externalStatus,\n            // Pass quality analysis if available\n            quality: res.quality\n        };\n\n        try {\n            await fetch('/api/results', {\n                method: 'POST',\n                body: JSON.stringify(payload)\n            });\n        } catch (postError) {\n            console.warn('Failed to send results, caching locally', postError);\n            const cached = JSON.parse(localStorage.getItem('offline_results') || '[]');\n            cached.push(payload);\n            localStorage.setItem('offline_results', JSON.stringify(cached));\n            setOfflineMode(true);\n        }\n\n    } catch (e) {\n        console.error(e);\n        if (retryCount < 3) {\n            console.log(`Retrying test... (${retryCount + 1}/3)`);\n            setRetryCount(prev => prev + 1);\n            setTimeout(runTest, 2000 * Math.pow(2, retryCount)); // Exponential backoff\n        } else {\n            setError('Erro ao executar teste após múltiplas tentativas. Verifique sua conexão.');\n            setHasStarted(false);\n        }\n    }\n  };\n\n  if (loading) return <div className=\"flex h-screen items-center justify-center bg-background text-foreground\"><Loader2 className=\"animate-spin h-8 w-8 text-primary\" /></div>;\n  if (error) return <div className=\"flex h-screen items-center justify-center bg-background text-destructive font-semibold\">{error}</div>;\n\n  if (finished && result) {\n    return (\n      <div className=\"min-h-screen bg-background text-foreground flex flex-col items-center py-10 px-4\">\n        <div className=\"bg-card border border-border rounded-lg shadow-lg p-8 max-w-2xl w-full\">\n            <div className=\"flex flex-col items-center mb-6\">\n                <CheckCircle className=\"h-16 w-16 text-green-500 mb-4\" />\n                <h2 className=\"text-2xl font-bold\">Teste Concluído!</h2>\n                <p className=\"text-muted-foreground\">Seus resultados foram enviados com sucesso.</p>\n                {offlineMode && (\n                    <div className=\"mt-2 bg-yellow-100 text-yellow-800 px-3 py-1 rounded text-sm flex items-center gap-2\">\n                        <AlertTriangle size={14} /> Resultados salvos offline. Serão enviados ao reconectar.\n                    </div>\n                )}\n            </div>\n\n            {/* Quality Alert Section */}\n            {result.quality && (\n                <div className={`mb-6 p-4 rounded-lg border ${\n                    result.quality.rating === 'Excelente' || result.quality.rating === 'Bom' \n                        ? 'bg-green-50 border-green-200' \n                        : result.quality.rating === 'Regular' \n                            ? 'bg-yellow-50 border-yellow-200' \n                            : 'bg-red-50 border-red-200'\n                }`}>\n                    <h3 className=\"font-semibold text-lg flex items-center gap-2 mb-2\">\n                        <Activity size={20} /> Qualidade da Conexão: {result.quality.rating}\n                    </h3>\n                    \n                    {result.quality.issues.length > 0 && (\n                        <div className=\"mt-3\">\n                            <p className=\"font-medium text-sm mb-1\">Problemas Detectados:</p>\n                            <ul className=\"list-disc list-inside text-sm space-y-1\">\n                                {result.quality.issues.map((issue, idx) => (\n                                    <li key={idx}>{issue}</li>\n                                ))}\n                            </ul>\n                        </div>\n                    )}\n                    \n                    {result.quality.recommendations.length > 0 && (\n                        <div className=\"mt-3\">\n                            <p className=\"font-medium text-sm mb-1\">Sugestões:</p>\n                            <ul className=\"list-disc list-inside text-sm space-y-1\">\n                                {result.quality.recommendations.map((rec, idx) => (\n                                    <li key={idx}>{rec}</li>\n                                ))}\n                            </ul>\n                        </div>\n                    )}\n                </div>\n            )}\n\n            <div className=\"grid grid-cols-2 gap-4 mb-6\">\n                <div className=\"p-4 bg-muted rounded\">\n                    <p className=\"text-sm text-muted-foreground\">Download</p>\n                    <p className=\"text-xl font-bold\">{result.speed.download.toFixed(1)} Mbps</p>\n                </div>\n                <div className=\"p-4 bg-muted rounded\">\n                    <p className=\"text-sm text-muted-foreground\">Upload</p>\n                    <p className=\"text-xl font-bold\">{result.speed.upload.toFixed(1)} Mbps</p>\n                </div>\n                <div className=\"p-4 bg-muted rounded\">\n                    <p className=\"text-sm text-muted-foreground\">Ping</p>\n                    <p className=\"text-xl font-bold\">{result.speed.ping.toFixed(0)} ms</p>\n                </div>\n                <div className=\"p-4 bg-muted rounded\">\n                    <p className=\"text-sm text-muted-foreground\">Jitter</p>\n                    <p className=\"text-xl font-bold\">{result.speed.jitter.toFixed(0)} ms</p>\n                </div>\n            </div>\n\n            {/* Network Details */}\n            <div className=\"mb-6 border-t pt-4\">\n                 <h4 className=\"font-semibold mb-3 flex items-center gap-2\"><Wifi size={16}/> Detalhes da Rede</h4>\n                 <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                    <div>\n                        <span className=\"text-muted-foreground\">Tipo:</span> <span className=\"uppercase font-medium\">{result.network.connectionType || 'N/A'}</span>\n                    </div>\n                    {result.network.connectionType === 'wifi' && (\n                        <>\n                             <div>\n                                <span className=\"text-muted-foreground\">Frequência:</span> <span className=\"font-medium\">{result.network.frequency || '2.4'} GHz</span>\n                             </div>\n                             <div>\n                                <span className=\"text-muted-foreground\">Sinal:</span> <span className=\"font-medium\">{result.network.signalStrength || 0}%</span>\n                             </div>\n                        </>\n                    )}\n                 </div>\n            </div>\n\n            <div className=\"flex justify-center\">\n                <button \n                    onClick={() => window.location.reload()}\n                    className=\"bg-primary text-primary-foreground px-6 py-2 rounded hover:bg-primary/90\"\n                >\n                    Realizar Novo Teste\n                </button>\n            </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background text-foreground flex flex-col\">\n      {/* Header */}\n      <header className=\"border-b border-border bg-card py-4 px-6 flex items-center justify-between\">\n         <div className=\"flex items-center gap-2\">\n            <div className=\"h-8 w-8 bg-primary text-primary-foreground rounded flex items-center justify-center font-bold\">F4</div>\n            <span className=\"font-semibold text-lg\">Flow4Network</span>\n         </div>\n      </header>\n\n      <main className=\"flex-1 flex flex-col items-center justify-center p-4 md:p-8\">\n        <div className=\"w-full max-w-4xl\">\n            \n            {/* Start Screen */}\n            {!hasStarted && !finished && (\n                <div className=\"bg-card border border-border rounded-xl p-8 md:p-12 text-center shadow-lg\">\n                    <div className=\"mb-6 inline-flex h-20 w-20 items-center justify-center rounded-full bg-primary/10 text-primary\">\n                        <Wifi className=\"h-10 w-10\" />\n                    </div>\n                    <h1 className=\"text-3xl md:text-4xl font-bold mb-4\">Teste de Qualidade da Conexão</h1>\n                    <p className=\"text-muted-foreground text-lg mb-8 max-w-2xl mx-auto\">\n                        Este teste analisa velocidade, latência e estabilidade da sua internet para identificar possíveis problemas de performance.\n                    </p>\n\n                    {linkData.type !== 'UNIDENTIFIED' && !linkData.cpfCnpj && (\n                        <div className=\"mb-8 max-w-xs mx-auto text-left\">\n                            <label className=\"block text-sm font-medium text-muted-foreground mb-1\">CPF ou CNPJ</label>\n                            <input \n                                type=\"text\" \n                                className=\"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-primary\"\n                                value={cpfCnpj}\n                                onChange={e => setCpfCnpj(e.target.value)}\n                                placeholder=\"Digite seu CPF ou CNPJ\"\n                            />\n                        </div>\n                    )}\n\n                    <button \n                        onClick={runTest}\n                        className=\"inline-flex items-center gap-2 bg-primary text-primary-foreground hover:bg-blue-600 px-8 py-4 rounded-lg text-xl font-bold transition-all transform hover:scale-105\"\n                    >\n                        <Play className=\"h-6 w-6\" /> Iniciar Teste\n                    </button>\n                </div>\n            )}\n\n            {/* Progress Screen */}\n            {hasStarted && !finished && (\n                <div className=\"space-y-8\">\n                    {/* Stepper */}\n                    <div className=\"flex justify-between items-center px-4 md:px-12\">\n                        <StepItem step={1} current={currentStep} label=\"Dispositivo\" icon={Smartphone} />\n                        <div className=\"h-1 flex-1 bg-muted mx-2 rounded overflow-hidden\">\n                             <div className={cn(\"h-full bg-primary transition-all duration-500\", currentStep > 1 ? \"w-full\" : \"w-0\")} />\n                        </div>\n                        <StepItem step={2} current={currentStep} label=\"Rede\" icon={Globe} />\n                        <div className=\"h-1 flex-1 bg-muted mx-2 rounded overflow-hidden\">\n                             <div className={cn(\"h-full bg-primary transition-all duration-500\", currentStep > 2 ? \"w-full\" : \"w-0\")} />\n                        </div>\n                        <StepItem step={3} current={currentStep} label=\"Velocidade\" icon={Gauge} />\n                        <div className=\"h-1 flex-1 bg-muted mx-2 rounded overflow-hidden\">\n                             <div className={cn(\"h-full bg-primary transition-all duration-500\", currentStep > 3 ? \"w-full\" : \"w-0\")} />\n                        </div>\n                        <StepItem step={4} current={currentStep} label=\"Qualidade\" icon={CheckCircle} />\n                    </div>\n\n                    <div className=\"bg-card border border-border rounded-xl p-8 md:p-12 text-center shadow-lg relative overflow-hidden\">\n                         <div className=\"absolute top-0 left-0 h-1 bg-primary transition-all duration-300\" style={{ width: `${progress}%` }} />\n                         \n                         <div className=\"mb-6\">\n                             <Loader2 className=\"h-16 w-16 text-primary animate-spin mx-auto\" />\n                         </div>\n                         <h2 className=\"text-2xl font-bold mb-2\">{statusMsg}</h2>\n                         <p className=\"text-muted-foreground\">Aguarde enquanto analisamos sua conexão...</p>\n                         <div className=\"mt-4 text-2xl font-mono font-bold text-primary\">{Math.round(progress)}%</div>\n                    </div>\n                </div>\n            )}\n\n            {/* Results Screen */}\n            {finished && result && (\n                <div className=\"space-y-6 animate-in fade-in duration-700 slide-in-from-bottom-4\">\n                    {/* Status Header */}\n                    <div className=\"bg-card border border-border rounded-xl p-6 flex flex-col md:flex-row items-center gap-6 shadow-lg\">\n                        <div className={cn(\n                            \"h-16 w-16 rounded-full flex items-center justify-center shrink-0\",\n                            result.speed.download > 10 && result.speed.packetLoss < 1 ? \"bg-success/20 text-success\" : \"bg-warning/20 text-warning\"\n                        )}>\n                            {result.speed.download > 10 && result.speed.packetLoss < 1 ? <CheckCircle className=\"h-8 w-8\" /> : <AlertTriangle className=\"h-8 w-8\" />}\n                        </div>\n                        <div className=\"text-center md:text-left\">\n                            <h2 className=\"text-2xl font-bold mb-1\">\n                                {result.speed.download > 10 && result.speed.packetLoss < 1 ? \"Conexão Estável\" : \"Conexão com Instabilidade\"}\n                            </h2>\n                            <p className=\"text-muted-foreground\">\n                                {result.speed.download > 10 && result.speed.packetLoss < 1 \n                                    ? \"Sua conexão está ótima para streaming em 4K, jogos online e chamadas de vídeo.\"\n                                    : \"Detectamos variações que podem afetar chamadas de vídeo e jogos online.\"}\n                            </p>\n                        </div>\n                    </div>\n\n                    {/* Main Metrics */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                        <MetricCard \n                            title=\"Download\" \n                            value={result.speed.download.toFixed(1)} \n                            unit=\"Mbps\" \n                            icon={Gauge} \n                            color=\"text-success\"\n                        />\n                         <MetricCard \n                            title=\"Upload\" \n                            value={result.speed.upload.toFixed(1)} \n                            unit=\"Mbps\" \n                            icon={Gauge} \n                            color=\"text-primary\"\n                        />\n                         <MetricCard \n                            title=\"Ping\" \n                            value={result.speed.ping.toFixed(0)} \n                            unit=\"ms\" \n                            icon={Zap} \n                            color=\"text-yellow-500\"\n                        />\n                         <MetricCard \n                            title=\"Jitter\" \n                            value={result.speed.jitter.toFixed(0)} \n                            unit=\"ms\" \n                            icon={Zap} \n                            color=\"text-muted-foreground\"\n                        />\n                    </div>\n\n                    {/* Quality of Experience */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div className=\"bg-card border border-border rounded-xl p-6\">\n                            <h3 className=\"font-semibold text-lg mb-4 flex items-center gap-2\">\n                                <Monitor className=\"h-5 w-5 text-primary\" /> Experiência de Uso\n                            </h3>\n                            <div className=\"space-y-4\">\n                                <QualityRow \n                                    label=\"Streaming 4K / UHD\" \n                                    status={result.streaming.uhd} \n                                    icon={Video}\n                                />\n                                <QualityRow \n                                    label=\"Jogos Online\" \n                                    status={result.speed.ping < 50 && result.speed.jitter < 10} \n                                    icon={Gamepad2}\n                                />\n                                <QualityRow \n                                    label=\"Chamadas de Vídeo\" \n                                    status={result.speed.upload > 2 && result.speed.jitter < 30} \n                                    icon={Radio}\n                                />\n                            </div>\n                        </div>\n\n                         <div className=\"bg-card border border-border rounded-xl p-6\">\n                            <h3 className=\"font-semibold text-lg mb-4 flex items-center gap-2\">\n                                <Globe className=\"h-5 w-5 text-primary\" /> Serviços Externos\n                            </h3>\n                            <div className=\"space-y-3\">\n                                {result.externalStatus && JSON.parse(result.externalStatus).map((s: any) => (\n                                    <div key={s.name} className=\"flex justify-between items-center p-2 rounded bg-background/50\">\n                                        <span className=\"font-medium\">{s.name}</span>\n                                        <div className=\"flex items-center gap-2\">\n                                            {s.status === 'up' \n                                                ? <span className=\"text-xs font-bold text-success bg-success/10 px-2 py-1 rounded\">ONLINE</span>\n                                                : <span className=\"text-xs font-bold text-destructive bg-destructive/10 px-2 py-1 rounded\">OFFLINE</span>\n                                            }\n                                            {s.status === 'up' && <span className=\"text-xs text-muted-foreground\">{Math.round(s.latency)}ms</span>}\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Technical Details Accordion (Simplified as a box for now) */}\n                    <div className=\"bg-card border border-border rounded-xl p-6\">\n                        <details className=\"group\">\n                            <summary className=\"flex cursor-pointer items-center justify-between font-medium text-muted-foreground hover:text-foreground\">\n                                <span>Ver Detalhes Técnicos</span>\n                                <span className=\"transition group-open:rotate-180\">\n                                    <svg fill=\"none\" height=\"24\" shapeRendering=\"geometricPrecision\" stroke=\"currentColor\" strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"1.5\" viewBox=\"0 0 24 24\" width=\"24\"><path d=\"M6 9l6 6 6-6\"></path></svg>\n                                </span>\n                            </summary>\n                            <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm pt-4 border-t border-border\">\n                                <div>\n                                    <span className=\"block text-muted-foreground\">IP Público</span>\n                                    <span className=\"font-mono\">{result.network.ip}</span>\n                                </div>\n                                <div>\n                                    <span className=\"block text-muted-foreground\">Sistema Operacional</span>\n                                    <span>{result.device.os} ({result.device.browser})</span>\n                                </div>\n                                <div>\n                                    <span className=\"block text-muted-foreground\">Conexão</span>\n                                    <span>{result.network.connectionType || 'Desconhecido'}</span>\n                                </div>\n                                 <div>\n                                    <span className=\"block text-muted-foreground\">User Agent</span>\n                                    <span className=\"break-all text-xs text-muted-foreground\">{result.device.userAgent}</span>\n                                </div>\n                            </div>\n                        </details>\n                    </div>\n\n                    <div className=\"flex justify-center pt-4\">\n                        <button onClick={() => window.location.reload()} className=\"text-primary hover:underline\">\n                            Realizar novo teste\n                        </button>\n                    </div>\n                </div>\n            )}\n        </div>\n      </main>\n    </div>\n  );\n}\n\n// Subcomponents\n\nfunction StepItem({ step, current, label, icon: Icon }: { step: number, current: number, label: string, icon: any }) {\n    const isActive = current === step;\n    const isCompleted = current > step;\n    \n    return (\n        <div className=\"flex flex-col items-center gap-2\">\n            <div className={cn(\n                \"h-10 w-10 rounded-full flex items-center justify-center transition-all duration-300\",\n                isActive ? \"bg-primary text-primary-foreground scale-110 shadow-lg ring-4 ring-primary/20\" : \n                isCompleted ? \"bg-success text-success-foreground\" : \"bg-muted text-muted-foreground\"\n            )}>\n                {isCompleted ? <CheckCircle className=\"h-5 w-5\" /> : <Icon className=\"h-5 w-5\" />}\n            </div>\n            <span className={cn(\n                \"text-sm font-medium transition-colors\",\n                isActive ? \"text-primary\" : isCompleted ? \"text-success\" : \"text-muted-foreground\"\n            )}>{label}</span>\n        </div>\n    )\n}\n\nfunction MetricCard({ title, value, unit, icon: Icon, color }: { title: string, value: string, unit: string, icon: any, color: string }) {\n    return (\n        <div className=\"bg-card border border-border rounded-xl p-4 flex flex-col justify-between shadow-sm\">\n            <div className=\"flex justify-between items-start mb-2\">\n                <span className=\"text-muted-foreground text-sm font-medium\">{title}</span>\n                <Icon className={cn(\"h-4 w-4\", color)} />\n            </div>\n            <div className=\"flex items-baseline gap-1\">\n                <span className=\"text-2xl font-bold\">{value}</span>\n                <span className=\"text-xs text-muted-foreground\">{unit}</span>\n            </div>\n        </div>\n    )\n}\n\nfunction QualityRow({ label, status, icon: Icon }: { label: string, status: boolean, icon: any }) {\n    return (\n        <div className=\"flex items-center justify-between p-3 rounded-lg border border-border bg-background/50\">\n            <div className=\"flex items-center gap-3\">\n                <div className={cn(\"p-2 rounded-full\", status ? \"bg-success/10 text-success\" : \"bg-warning/10 text-warning\")}>\n                    <Icon className=\"h-4 w-4\" />\n                </div>\n                <span className=\"font-medium\">{label}</span>\n            </div>\n            {status ? (\n                <span className=\"text-xs font-bold text-success bg-success/10 px-2 py-1 rounded-full\">Excelente</span>\n            ) : (\n                <span className=\"text-xs font-bold text-warning bg-warning/10 px-2 py-1 rounded-full\">Instável</span>\n            )}\n        </div>\n    )\n}\n\nfunction Zap(props: any) {\n    return (\n         <svg\n      {...props}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <polygon points=\"13 2 3 14 12 14 11 22 21 10 12 10 13 2\" />\n    </svg>\n    )\n}\n"],"names":[],"mappings":"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"}}]
}