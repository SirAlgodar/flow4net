{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'super-secret-key-change-this';\n\nexport interface TokenPayload {\n  userId: string;\n  role: string;\n  username: string;\n}\n\nexport function signToken(payload: TokenPayload, expiresIn: string | number = '8h'): string {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: expiresIn as any });\n}\n\nexport function verifyToken(token: string): TokenPayload | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as TokenPayload;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return await bcrypt.hash(password, 10);\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return await bcrypt.compare(password, hash);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQtC,SAAS,UAAU,OAAqB,EAAE,YAA6B,IAAI;IAChF,OAAO,gMAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAiB;AACrE;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,gMAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,aAAa,QAAgB;IACjD,OAAO,MAAM,4LAAM,CAAC,IAAI,CAAC,UAAU;AACrC;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,MAAM,4LAAM,CAAC,OAAO,CAAC,UAAU;AACxC"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/app/api/admin/reports/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\nimport { verifyToken } from '@/lib/auth';\nimport { cookies } from 'next/headers';\nimport { startOfMonth, subMonths, endOfMonth, format } from 'date-fns';\n\nconst prisma = new PrismaClient();\n\nexport async function GET(request: Request) {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('token')?.value;\n\n    if (!token) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    if (!verifyToken(token)) return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\n\n    const { searchParams } = new URL(request.url);\n    const range = searchParams.get('range') || '30days';\n\n    // Summary Stats\n    const totalTests = await prisma.testLink.count();\n    const totalResults = await prisma.testResult.count();\n    const activeTests = await prisma.testLink.count({ where: { isActive: true } });\n    \n    // Recent activity (last 30 days)\n    const thirtyDaysAgo = subMonths(new Date(), 1);\n    \n    const testsByDay = await prisma.testResult.groupBy({\n        by: ['createdAt'],\n        _count: { id: true },\n        where: { createdAt: { gte: thirtyDaysAgo } },\n        orderBy: { createdAt: 'asc' }\n    });\n\n    // Format for chart (group by day)\n    const chartDataMap = new Map();\n    testsByDay.forEach(item => {\n        const day = format(item.createdAt, 'yyyy-MM-dd');\n        chartDataMap.set(day, (chartDataMap.get(day) || 0) + item._count.id);\n    });\n\n    const chartData = Array.from(chartDataMap.entries()).map(([date, count]) => ({\n        date,\n        count\n    }));\n\n    // Distribution by Type\n    const byType = await prisma.testLink.groupBy({\n        by: ['type'],\n        _count: { id: true }\n    });\n\n    return NextResponse.json({\n        summary: {\n            totalTests,\n            totalResults,\n            activeTests,\n            completionRate: totalTests > 0 ? Math.round((totalResults / totalTests) * 100) : 0\n        },\n        chartData,\n        byType: byType.map(t => ({ name: t.type, value: t._count.id }))\n    });\n\n  } catch (error) {\n    console.error('Error fetching reports:', error);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;AAEA,MAAM,SAAS,IAAI,oPAAY;AAExB,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,0LAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,UAAU;QAExC,IAAI,CAAC,OAAO,OAAO,8LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAC9E,IAAI,CAAC,IAAA,iLAAW,EAAC,QAAQ,OAAO,8LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;QAE5F,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY;QAE3C,gBAAgB;QAChB,MAAM,aAAa,MAAM,OAAO,QAAQ,CAAC,KAAK;QAC9C,MAAM,eAAe,MAAM,OAAO,UAAU,CAAC,KAAK;QAClD,MAAM,cAAc,MAAM,OAAO,QAAQ,CAAC,KAAK,CAAC;YAAE,OAAO;gBAAE,UAAU;YAAK;QAAE;QAE5E,iCAAiC;QACjC,MAAM,gBAAgB,IAAA,qMAAS,EAAC,IAAI,QAAQ;QAE5C,MAAM,aAAa,MAAM,OAAO,UAAU,CAAC,OAAO,CAAC;YAC/C,IAAI;gBAAC;aAAY;YACjB,QAAQ;gBAAE,IAAI;YAAK;YACnB,OAAO;gBAAE,WAAW;oBAAE,KAAK;gBAAc;YAAE;YAC3C,SAAS;gBAAE,WAAW;YAAM;QAChC;QAEA,kCAAkC;QAClC,MAAM,eAAe,IAAI;QACzB,WAAW,OAAO,CAAC,CAAA;YACf,MAAM,MAAM,IAAA,+MAAM,EAAC,KAAK,SAAS,EAAE;YACnC,aAAa,GAAG,CAAC,KAAK,CAAC,aAAa,GAAG,CAAC,QAAQ,CAAC,IAAI,KAAK,MAAM,CAAC,EAAE;QACvE;QAEA,MAAM,YAAY,MAAM,IAAI,CAAC,aAAa,OAAO,IAAI,GAAG,CAAC,CAAC,CAAC,MAAM,MAAM,GAAK,CAAC;gBACzE;gBACA;YACJ,CAAC;QAED,uBAAuB;QACvB,MAAM,SAAS,MAAM,OAAO,QAAQ,CAAC,OAAO,CAAC;YACzC,IAAI;gBAAC;aAAO;YACZ,QAAQ;gBAAE,IAAI;YAAK;QACvB;QAEA,OAAO,8LAAY,CAAC,IAAI,CAAC;YACrB,SAAS;gBACL;gBACA;gBACA;gBACA,gBAAgB,aAAa,IAAI,KAAK,KAAK,CAAC,AAAC,eAAe,aAAc,OAAO;YACrF;YACA;YACA,QAAQ,OAAO,GAAG,CAAC,CAAA,IAAK,CAAC;oBAAE,MAAM,EAAE,IAAI;oBAAE,OAAO,EAAE,MAAM,CAAC,EAAE;gBAAC,CAAC;QACjE;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,8LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}