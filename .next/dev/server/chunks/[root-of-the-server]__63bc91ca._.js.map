{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'super-secret-key-change-this';\n\nexport interface TokenPayload {\n  userId: string;\n  role: string;\n  username: string;\n}\n\nexport function signToken(payload: TokenPayload, expiresIn: string | number = '8h'): string {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: expiresIn as any });\n}\n\nexport function verifyToken(token: string): TokenPayload | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as TokenPayload;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return await bcrypt.hash(password, 10);\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return await bcrypt.compare(password, hash);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQtC,SAAS,UAAU,OAAqB,EAAE,YAA6B,IAAI;IAChF,OAAO,gMAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAiB;AACrE;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,gMAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,aAAa,QAAgB;IACjD,OAAO,MAAM,4LAAM,CAAC,IAAI,CAAC,UAAU;AACrC;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,MAAM,4LAAM,CAAC,OAAO,CAAC,UAAU;AACxC"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/app/api/admin/links/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\nimport { z } from 'zod';\nimport { verifyToken } from '@/lib/auth';\nimport { cookies } from 'next/headers';\n\nconst prisma = new PrismaClient();\n\nconst createLinkSchema = z.object({\n  type: z.enum(['QUICK', 'IDENTIFIED', 'UNIDENTIFIED']),\n  code: z.string().optional().nullable(),\n  expiresAt: z.string().optional().nullable(),\n  cpfCnpj: z.string().optional().nullable(),\n  config: z.object({\n    allowSpeedTest: z.boolean().default(true),\n    allowPing: z.boolean().default(true),\n    allowTraceroute: z.boolean().default(true),\n    allowVideo: z.boolean().default(true),\n    allowVoip: z.boolean().default(true),\n    allowWeb: z.boolean().default(true),\n  }).optional(),\n});\n\nfunction generateCode(length = 6): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\nexport async function POST(request: Request) {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('token')?.value;\n\n    if (!token) {\n      return NextResponse.json({ error: 'Não autorizado' }, { status: 401 });\n    }\n\n    const payload = verifyToken(token);\n    if (!payload) {\n      return NextResponse.json({ error: 'Token inválido' }, { status: 401 });\n    }\n\n    const body = await request.json();\n    const validation = createLinkSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json({ error: validation.error.issues[0].message }, { status: 400 });\n    }\n\n    const { type, code, expiresAt, cpfCnpj, config } = validation.data;\n\n    // Validate CPF/CNPJ if type is IDENTIFIED\n    if (type === 'IDENTIFIED' && !cpfCnpj) {\n        return NextResponse.json({ error: 'CPF/CNPJ é obrigatório para links identificados' }, { status: 400 });\n    }\n\n    // Generate code if not provided\n    let finalCode = code;\n    if (!finalCode) {\n        let isUnique = false;\n        while (!isUnique) {\n            finalCode = generateCode();\n            const existing = await prisma.testLink.findUnique({ where: { code: finalCode } });\n            if (!existing) isUnique = true;\n        }\n    } else {\n        // Check if provided code exists\n        const existing = await prisma.testLink.findUnique({ where: { code: finalCode } });\n        if (existing) {\n            return NextResponse.json({ error: 'Código já existe' }, { status: 400 });\n        }\n    }\n\n    const newLink = await prisma.testLink.create({\n        data: {\n            code: finalCode!,\n            type,\n            creatorId: payload.userId,\n            expiresAt: expiresAt ? new Date(expiresAt) : null,\n            cpfCnpj,\n            config: config || {},\n        }\n    });\n\n    return NextResponse.json({ success: true, link: newLink });\n\n  } catch (error: any) {\n    console.error('Error creating link:', error);\n    return NextResponse.json({ error: 'Erro interno ao criar link' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}