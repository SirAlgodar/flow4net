{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'super-secret-key-change-this';\n\nexport interface TokenPayload {\n  userId: string;\n  role: string;\n  username: string;\n}\n\nexport function signToken(payload: TokenPayload, expiresIn: string | number = '8h'): string {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: expiresIn as any });\n}\n\nexport function verifyToken(token: string): TokenPayload | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as TokenPayload;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return await bcrypt.hash(password, 10);\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return await bcrypt.compare(password, hash);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQtC,SAAS,UAAU,OAAqB,EAAE,YAA6B,IAAI;IAChF,OAAO,gMAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAiB;AACrE;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,gMAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,aAAa,QAAgB;IACjD,OAAO,MAAM,4LAAM,CAAC,IAAI,CAAC,UAAU;AACrC;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,MAAM,4LAAM,CAAC,OAAO,CAAC,UAAU;AACxC"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/app/api/admin/users/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\nimport { z } from 'zod';\nimport { hashPassword, verifyToken } from '@/lib/auth';\nimport { cookies } from 'next/headers';\n\nconst prisma = new PrismaClient();\n\nconst createUserSchema = z.object({\n  name: z.string().min(1, 'Nome é obrigatório'),\n  email: z.string().email('Email inválido'),\n  username: z.string().min(1, 'Username é obrigatório'),\n  password: z.string().min(6, 'Senha deve ter no mínimo 6 caracteres'),\n  role: z.enum(['ADMIN', 'SUPERVISOR', 'ATTENDANT']),\n});\n\nexport async function GET(request: Request) {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('token')?.value;\n\n    if (!token) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    if (!verifyToken(token)) return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\n\n    const users = await prisma.user.findMany({\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        username: true,\n        role: true,\n        createdAt: true,\n        updatedAt: true,\n        failedLoginAttempts: true,\n        lockoutUntil: true,\n      },\n      orderBy: { createdAt: 'desc' },\n    });\n\n    return NextResponse.json(users);\n  } catch (error) {\n    console.error('Error fetching users:', error);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('token')?.value;\n\n    if (!token) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    if (!verifyToken(token)) return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\n\n    const body = await request.json();\n    const validation = createUserSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json({ error: validation.error.issues[0].message }, { status: 400 });\n    }\n\n    const { name, email, username, password, role } = validation.data;\n\n    // Check if user already exists\n    const existingUser = await prisma.user.findFirst({\n      where: {\n        OR: [\n          { email },\n          { username }\n        ]\n      }\n    });\n\n    if (existingUser) {\n      return NextResponse.json({ error: 'Email ou Username já está em uso' }, { status: 409 });\n    }\n\n    const hashedPassword = await hashPassword(password);\n\n    const newUser = await prisma.user.create({\n      data: {\n        name,\n        email,\n        username,\n        password: hashedPassword,\n        role,\n      },\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        username: true,\n        role: true,\n        createdAt: true,\n      }\n    });\n\n    return NextResponse.json(newUser, { status: 201 });\n\n  } catch (error) {\n    console.error('Error creating user:', error);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}