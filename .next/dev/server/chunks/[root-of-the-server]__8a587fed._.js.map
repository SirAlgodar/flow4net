{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'super-secret-key-change-this';\n\nexport interface TokenPayload {\n  userId: string;\n  role: string;\n  username: string;\n}\n\nexport function signToken(payload: TokenPayload, expiresIn: string | number = '8h'): string {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: expiresIn as any });\n}\n\nexport function verifyToken(token: string): TokenPayload | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as TokenPayload;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return await bcrypt.hash(password, 10);\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return await bcrypt.compare(password, hash);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQtC,SAAS,UAAU,OAAqB,EAAE,YAA6B,IAAI;IAChF,OAAO,gMAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAiB;AACrE;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,gMAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,aAAa,QAAgB;IACjD,OAAO,MAAM,4LAAM,CAAC,IAAI,CAAC,UAAU;AACrC;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,MAAM,4LAAM,CAAC,OAAO,CAAC,UAAU;AACxC"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///Users/gabrieldesouza/Documents/trae_projects/flow4network/src/app/api/admin/tests/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\nimport { z } from 'zod';\nimport { verifyToken } from '@/lib/auth';\nimport { cookies } from 'next/headers';\n\nconst prisma = new PrismaClient();\n\nexport async function GET(request: Request) {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('token')?.value;\n\n    if (!token) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const payload = verifyToken(token);\n    if (!payload) {\n      return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const type = searchParams.get('type');\n    const status = searchParams.get('status');\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const skip = (page - 1) * limit;\n\n    const where: any = {};\n    if (type && type !== 'ALL') where.type = type;\n    if (status) {\n        if (status === 'ACTIVE') where.isActive = true;\n        if (status === 'INACTIVE') where.isActive = false;\n    }\n\n    // Determine total count for pagination\n    const total = await prisma.testLink.count({ where });\n\n    const tests = await prisma.testLink.findMany({\n      where,\n      skip,\n      take: limit,\n      orderBy: { createdAt: 'desc' },\n      include: {\n        creator: { select: { name: true, email: true } },\n        results: {\n            select: { id: true, createdAt: true },\n            orderBy: { createdAt: 'desc' },\n            take: 1\n        },\n        _count: { select: { results: true } }\n      }\n    });\n\n    const formattedTests = tests.map(test => ({\n        id: test.id,\n        code: test.code,\n        type: test.type,\n        creator: test.creator?.name || 'Sistema',\n        createdAt: test.createdAt,\n        expiresAt: test.expiresAt,\n        isActive: test.isActive,\n        resultsCount: test._count.results,\n        lastResultAt: test.results[0]?.createdAt || null\n    }));\n\n    return NextResponse.json({\n        data: formattedTests,\n        meta: {\n            total,\n            page,\n            limit,\n            totalPages: Math.ceil(total / limit)\n        }\n    });\n\n  } catch (error) {\n    console.error('Error fetching tests:', error);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n\n// Action to Pause/Resume/Delete\nexport async function PATCH(request: Request) {\n    try {\n        const cookieStore = await cookies();\n        const token = cookieStore.get('token')?.value;\n        if (!token) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n\n        const body = await request.json();\n        const { id, action } = body;\n\n        if (!id || !action) {\n            return NextResponse.json({ error: 'Missing parameters' }, { status: 400 });\n        }\n\n        if (action === 'TOGGLE_STATUS') {\n            const link = await prisma.testLink.findUnique({ where: { id } });\n            if (!link) return NextResponse.json({ error: 'Not found' }, { status: 404 });\n            \n            await prisma.testLink.update({\n                where: { id },\n                data: { isActive: !link.isActive }\n            });\n            return NextResponse.json({ success: true });\n        }\n\n        return NextResponse.json({ error: 'Invalid action' }, { status: 400 });\n\n    } catch (error) {\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":"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"}}]
}