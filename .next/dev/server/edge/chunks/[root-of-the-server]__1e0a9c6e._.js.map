{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Documents/trae_projects/flow4network/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { jwtVerify } from 'jose';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'super-secret-key-change-this';\n\nexport async function middleware(request: NextRequest) {\n  const token = request.cookies.get('token')?.value;\n  const { pathname } = request.nextUrl;\n\n  // 1. If trying to access login page\n  if (pathname === '/login') {\n    if (token) {\n      try {\n        await jwtVerify(token, new TextEncoder().encode(JWT_SECRET));\n        // Token is valid, redirect to dashboard\n        return NextResponse.redirect(new URL('/admin', request.url));\n      } catch (e) {\n        // Token invalid, let them login\n        return NextResponse.next();\n      }\n    }\n    return NextResponse.next();\n  }\n\n  // 2. If trying to access protected routes (e.g. /admin)\n  if (pathname.startsWith('/admin')) {\n    if (!token) {\n      return NextResponse.redirect(new URL('/login', request.url));\n    }\n\n    try {\n      await jwtVerify(token, new TextEncoder().encode(JWT_SECRET));\n      return NextResponse.next();\n    } catch (e) {\n      // Token invalid\n      return NextResponse.redirect(new URL('/login', request.url));\n    }\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: ['/login', '/admin/:path*'],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,WAAW,OAAoB;IACnD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;IAC5C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,oCAAoC;IACpC,IAAI,aAAa,UAAU;QACzB,IAAI,OAAO;YACT,IAAI;gBACF,MAAM,IAAA,0NAAS,EAAC,OAAO,IAAI,cAAc,MAAM,CAAC;gBAChD,wCAAwC;gBACxC,OAAO,8OAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC5D,EAAE,OAAO,GAAG;gBACV,gCAAgC;gBAChC,OAAO,8OAAY,CAAC,IAAI;YAC1B;QACF;QACA,OAAO,8OAAY,CAAC,IAAI;IAC1B;IAEA,wDAAwD;IACxD,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,IAAI,CAAC,OAAO;YACV,OAAO,8OAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QAEA,IAAI;YACF,MAAM,IAAA,0NAAS,EAAC,OAAO,IAAI,cAAc,MAAM,CAAC;YAChD,OAAO,8OAAY,CAAC,IAAI;QAC1B,EAAE,OAAO,GAAG;YACV,gBAAgB;YAChB,OAAO,8OAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;IACF;IAEA,OAAO,8OAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAU;KAAgB;AACtC"}}]
}